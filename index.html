<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vendor Booking Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input, select { width: 100%; padding: 8px; margin-bottom: 10px; }
    button { padding: 10px 20px; background-color: #28a745; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #218838; }
    #response { margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    @media (max-width: 600px) { table, th, td { font-size: 12px; } }
  </style>
</head>
<body>
  <h1>Vendor Booking Tracker</h1>
  
  <!-- Form to Submit Bookings -->
  <h2>Add New Booking</h2>
  <form id="bookingForm">
    <div class="form-group">
      <label for="orderedDate">Ordered Date:</label>
      <input type="date" id="orderedDate" name="orderedDate" required>
    </div>
    <div class="form-group">
      <label for="platform">Platform:</label>
      <select id="platform" name="platform" required>
        <option value="">Select Platform</option>
        <option value="Amazon">Amazon</option>
        <option value="Flipkart">Flipkart</option>
      </select>
    </div>
    <div class="form-group">
      <label for="phoneModel">Phone Model:</label>
      <input type="text" id="phoneModel" name="phoneModel" required>
    </div>
    <div class="form-group">
      <label for="cardUsed">Card Used:</label>
      <input type="text" id="cardUsed" name="cardUsed" required>
    </div>
    <div class="form-group">
      <label for="bookingAmount">Booking Amount:</label>
      <input type="number" id="bookingAmount" name="bookingAmount" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="cbCharges">CB/Charges (if any):</label>
      <input type="text" id="cbCharges" name="cbCharges">
    </div>
    <div class="form-group">
      <label for="netLanding">Net Landing (after charges/cashback):</label>
      <input type="number" id="netLanding" name="netLanding" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="returnAmount">Return Amount:</label>
      <input type="number" id="returnAmount" name="returnAmount" step="0.01" default="0">
    </div>
    <div class="form-group">
      <label for="paid">Paid:</label>
      <input type="number" id="paid" name="paid" step="0.01" default="0">
    </div>
    <div class="form-group">
      <label for="balance">Balance:</label>
      <input type="number" id="balance" name="balance" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="profit">Profit:</label>
      <input type="number" id="profit" name="profit" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="profitPercentage">Profit Percentage:</label>
      <input type="number" id="profitPercentage" name="profitPercentage" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="paymentStatus">Payment Status:</label>
      <select id="paymentStatus" name="paymentStatus" required>
        <option value="">Select Status</option>
        <option value="Pending">Pending</option>
        <option value="Completed">Completed</option>
        <option value="Failed">Failed</option>
      </select>
    </div>
    <div class="form-group">
      <label for="paymentDate">Payment Date:</label>
      <input type="date" id="paymentDate" name="paymentDate">
    </div>
    <button type="submit">Submit Booking</button>
  </form>
  <div id="response"></div>

  <!-- Section to Display Bookings -->
  <h2>Booking History</h2>
  <button id="fetchBookings">Load Bookings</button>
  <table id="bookingsTable" style="display: none;">
    <thead>
      <tr>
        <th>Ordered Date</th>
        <th>Platform</th>
        <th>Phone Model</th>
        <th>Card Used</th>
        <th>Booking Amount</th>
        <th>CB/Charges</th>
        <th>Net Landing</th>
        <th>Return Amount</th>
        <th>Paid</th>
        <th>Balance</th>
        <th>Profit</th>
        <th>Profit %</th>
        <th>Payment Status</th>
        <th>Payment Date</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody id="bookingsBody"></tbody>
  </table>

  <script>
    const form = document.getElementById('bookingForm');
    const responseDiv = document.getElementById('response');
    const fetchButton = document.getElementById('fetchBookings');
    const bookingsTable = document.getElementById('bookingsTable');
    const bookingsBody = document.getElementById('bookingsBody');
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbxvEmD7E2u9-rdgfQKg3NRbeOZIqZQ8AMVBwY70oNKpubdKgRn0AiLh5BTazmrn6CV0cg/exec'; // Replace with your Web app URL

    // Handle form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        orderedDate: form.orderedDate.value,
        platform: form.platform.value,
        phoneModel: form.phoneModel.value,
        cardUsed: form.cardUsed.value,
        bookingAmount: form.bookingAmount.value,
        cbCharges: form.cbCharges.value,
        netLanding: form.netLanding.value,
        returnAmount: form.returnAmount.value || 0,
        paid: form.paid.value || 0,
        balance: form.balance.value,
        profit: form.profit.value,
        profitPercentage: form.profitPercentage.value,
        paymentStatus: form.paymentStatus.value,
        paymentDate: form.paymentDate.value
      };

      try {
        const response = await fetch(scriptUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
          mode: 'cors'
        });

        const result = await response.json();
        responseDiv.innerHTML = `<p style="color: green;">${result.message}</p>`;
        form.reset();
      } catch (error) {
        responseDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
      }
    });

    // Handle fetching bookings
    fetchButton.addEventListener('click', async () => {
      try {
        const response = await fetch(scriptUrl, {
          method: 'GET',
          mode: 'cors'
        });
        const result = await response.json();

        if (result.status === 'success') {
          bookingsBody.innerHTML = ''; // Clear existing rows
          result.data.forEach(booking => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${booking.orderedDate}</td>
              <td>${booking.platform}</td>
              <td>${booking.phoneModel}</td>
              <td>${booking.cardUsed}</td>
              <td>${booking.bookingAmount}</td>
              <td>${booking.cbCharges || ''}</td>
              <td>${booking.netLanding}</td>
              <td>${booking.returnAmount}</td>
              <td>${booking.paid}</td>
              <td>${booking.balance}</td>
              <td>${booking.profit}</td>
              <td>${booking.profitPercentage}</td>
              <td>${booking.paymentStatus}</td>
              <td>${booking.paymentDate || ''}</td>
              <td>${new Date(booking.timestamp).toLocaleString()}</td>
            `;
            bookingsBody.appendChild(row);
          });
          bookingsTable.style.display = 'table';
        } else {
          responseDiv.innerHTML = `<p style="color: red;">Error: ${result.message}</p>`;
        }
      } catch (error) {
        responseDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
      }
    });
  </script>
</body>
</html>
